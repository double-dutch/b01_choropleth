<!DOCTYPE html>
<meta charset="utf-8">
<style>

path {
  stroke:white;
  stroke-width: .5px;
}

body {
  font-family: Arial, sans-serif;
}

.buttons {
  position: absolute;
  top: 10px;
  left: 10px;
}

.buttons label {
  margin-left: 20px;
}

.hlight {
  background-color:#edf8fb;
  -moz-border-radius: 5px;
  -webkit-border-radius: 5px;
  border: .5px solid  #00441b;
}

.legend {
  font-size: 12px;
}

</style>

<div class="buttons">
  <input type="submit" value="1" class="button--1 hlight" style="width: 50px;" />
  <input type="submit" value="2" class="button--2" style="width: 50px;" />
  <input type="submit" value="3" class="button--3" style="width: 50px;" />
</div>
<script src="http://d3js.org/d3.v3.min.js"></script>
<script type="text/javascript" src="http://d3js.org/queue.v1.min.js"></script>
<script src="http://d3js.org/topojson.v1.min.js"></script>
<script src="//code.jquery.com/jquery-1.10.2.js"></script>
<script>

  // Button highlighting
  $('input[type="submit"]').click(function(){
    $('input[type="submit"].hlight').removeClass('hlight')
        $(this).addClass('hlight');
  });

  // SVG Properties
  var width  = 960,
      height = 500;

  var projection = d3.geo.albersUsa()
    .scale(1000)
    .translate([width / 2, height / 2]);

  var color = d3.scale.log()
    .range(["#edf8fb", "#006d2c"])
    .interpolate(d3.interpolateHcl);

  var path = d3.geo.path()
    .projection(projection);

  var svg = d3.select("body").append("svg")
    .attr("width", width)
    .attr("height", height);


  // Reading data
  queue()
    .defer(d3.json,"../data/us-states-named.json")
    .await(ready);


  // Beginning of choropleth
  function ready(error, map) {

    // Data, removing Puerto Rico and the Virgin Islands
    var states = topojson.feature(map, map.objects.states).features;
    var states_clean = $.grep(states, function(e) {
        return e.properties.code!="VI" && e.properties.code != "PR" && e.properties.code != "DC"
    });
    console.log(states_clean);

    // Color domains
    d_1 = [d3.min(states_clean, function(d) { return parseInt(d.properties.nbrew); }),
           d3.max(states_clean, function(d) { return parseInt(d.properties.nbrew); })];
    d_2 = [d3.min(states_clean, function(d) { return parseFloat(d.properties.nbrew_norm_area); }),
           d3.max(states_clean, function(d) { return parseFloat(d.properties.nbrew_norm_area); })];
    d_3 = [d3.min(states_clean, function(d) { return parseFloat(d.properties.nbrew_norm_pop); }),
           d3.max(states_clean, function(d) { return parseFloat(d.properties.nbrew_norm_pop); })];
    color.domain(d_1);

    // Graphing states
    var state_paths = svg.selectAll("path")
      .data(states_clean)
    .enter().append("path")
      .attr("d", path)
      .style("fill", function(d) { return color(d.properties.nbrew); })

    // Shading transitions
    .on("mouseover", function(d) {
      d3.select(this.parentNode.appendChild(this)).transition().duration(200)
        .style({'stroke':'#00441b','stroke-width':'.5px'});
    })
    .on("mouseout", function(d) {
      d3.select(this.parentNode.appendChild(this)).transition().duration(200)
        .style('stroke','white');
    });


    // Transition 1: Number of breweries
    d3.selectAll(".button--1").on("click", function() {
      color.domain(d_1);
      state_paths.transition()
        .duration(1000)
        .style("fill", function(d) { return color(d.properties.nbrew); });
    });

    // Transition 2: Normalized for state land mass
    d3.selectAll(".button--2").on("click", function() {
      color.domain(d_2);
      state_paths.transition()
        .duration(1000)
        .style("fill", function(d) { return color(d.properties.nbrew_norm_area); });
    });

    // Transition 3: Normalized for state population
    d3.selectAll(".button--3").on("click", function() {
      color.domain(d_3);
      state_paths.transition()
        .duration(1000)
        .style("fill", function(d) { return color(d.properties.nbrew_norm_pop); });
    });

  };  // <--- End of choropleth


  // Legend
  var leg_labels = ['Less','','','More'];
  var col_labels = ['#edf8fb', '#99d8c9', '#41ae76', '#005824'];
  var legend = svg.selectAll("g.legend")
  .data(col_labels)
  .enter().append("g")
  .attr("class", "legend");

  var ls_w = 20, ls_h = 20;

  legend.append("rect")
  .attr("x", 20)
  .attr("y", function(d, i){ return height - (i*ls_h) - 2*ls_h;})
  .attr("width", ls_w)
  .attr("height", ls_h)
  .style("fill", function(d, i) { return d; });

  legend.append("text")
  .attr("x", 50)
  .attr("y", function(d, i){ return height - (i*ls_h) - ls_h - 4;})
  .text(function(d, i){ return leg_labels[i]; });


</script>
