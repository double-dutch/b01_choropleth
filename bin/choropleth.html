<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<title>Mapping</title>
		<script type="text/javascript" src="../d3/d3.v3.js"></script>
		<style type="text/css">
			/* No style rules here yet */
		</style>
	</head>
	<body>
		<script type="text/javascript">

			// Width and height
			var w = 1200;
			var h = 1000;

			// Define map projection
			var projection = d3.geo.albersUsa()
								   .translate([w/2, h/2])
								   .scale([1000]);

			// Define path generator
			var path = d3.geo.path()
							 .projection(projection);

			// Define quantize scale to sort data values into buckets of color
			var color = d3.scale.quantize()
								.range(["rgb(237,248,233)","rgb(186,228,179)","rgb(116,196,118)","rgb(49,163,84)","rgb(0,109,44)"]);

			// Create SVG element
			var svg = d3.select("body")
						.append("svg")
						.attr("width", w)
						.attr("height", h);

			// Load in brewery data
      var data_brew;
			d3.json("../data/breweries_US.json", function(brew) {

        // Set input domain for color scale
        color.domain([
					d3.min(brew, function(d) { return parseFloat(d.n_breweries); }),
					d3.max(brew, function(d) { return parseFloat(d.n_breweries); })
				]);

        // Load in GeoJSON data
        d3.json("../data/us-states.json", function(geo) {

          // Merge brewery data and GeoJSON
          for (var i = 0; i < brew.length; i++) {

            // Grab state name and number of breweries
            var state = brew[i].state;
            var nbrew = parseFloat(brew[i].n_breweries);

            // Finding the corresponding state in the GeoJSON data
            for (var j = 0; j < geo.features.length; j++) {

              // Copying the brewery data into the GeoJSON data
              var json_state = geo.features[j].properties.name;
              if (state == json_state) {
                geo.features[j].properties.value = nbrew;
                break;
              }
            }
          }
          console.log(geo.features);

          // Bind the data and create one path per GeoJSON feature
          svg.selectAll("path")
             .data(geo.features)
             .enter()
             .append("path")
             .attr("d",path)
             .style("fill", function(d) {
                var value = d.properties.value;
                if (value) {
                  return color(value);
                } else{
                  return "#ccc";
                }

             });

        });
      });




		</script>
	</body>
</html>
